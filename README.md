# Streamlining NGS Insights: From Raw Data to Athena Queries with Quilt Packages and Metadata

In this tutorial series, we demonstrate the benefit of packaging raw -omics data with .

The ultimate goal of this demo is to provide a framework capable of maximizing the utility of your data.

## Dataset

For the purpose of this tutorial, we are using a subset of publicly available RNA-sequencing data generated by the Cancer Cell Line Encyclopedia (CCLE) initiative. However, this tutorial is generalizable - with the core principles applying across data types, and reproducible with your in-house datasets.

## Project Outline

We have generated a series of 4 core tutorials (+ 1 optional) demonstrating framework to XXX

### 1. Annotated Quilt Packages for Raw NGS Data &  Metadata

> `00_curate_raw_rnaseq_dat.ipynb` (optional)
> `01_create_metadata_workflow_schema.ipynb`
> `02_generate_raw_data_pkgs_with_metadata.ipynb`

Raw data is either generated in house by an instrument, or as in the case of this demo, curated from a public source. Here, we downloaded raw RNA-sequencing data in the form of fastqs from the Sequence Read Archive (SRA). Raw sequencing data was then packaged into Quilt packages, 1 per package per sample. Sample-level metadata describing both biological (tumor type, patient age, histology ...) and technical (sequencer used, library kit, freezing media used for storage ...) features of the sample were obtained from SRA and attached as metadata to each Quilt package housing raw data. Quilt workflows & metadata schemas were used to ensure the integrity of the metadata across samples -- a key step to maximize the utility of sample metadata in downstream analysis! No more Tumor vs. tumor vs. tumour...!!

### 2. Tractable Nextflow Pipeline Processing with `nf-quilt`

> `03_run_nfcore_rnaseq_with_nfquilt.ipynb`

The Nextflow nf-core/rnaseq pipeline, in conjunction with nf-quilt was used to process raw sequencing data (fastqs) and generate per sample expression values. Samples were processed together in batches (called "runs"), mirroring common practice in NGC centers when multiple samples on a sequencing flow cell are pre-processed at the same time. The nf-quilt plugin automatically packages Nextflow pipeline output into a Quilt package, and appends detailed pipeline run metadata to the package.


### 3. Metadata & Pipeline Results Data Lake

> `04_athena_metadata_nfcore_output.ipynb`

To enable valuable data searches, we must align the sample-level metadata appended to the raw data packages to the pipeline outputs. In this demo, the primary data generated by the pipeline is expression tables. With Athena, its possible to integrate sample metadata & pipeline output tables together to empower quick queries and slicing and dicing of large datasets.

### 4. Efficiently Query & Analyze 

> `06_query_athena_data_and_perform_analysis`

Once Athena is enabled, the world (or data in this case...) is the Computational Biologist's oyster! Computational biologists can now use the Athena to make SQL queries to obtain desired subsets of data to empower their analysis quickly and efficiently. Queries can be performed directly in Jupyter notebooks, enabling seamless data loading upstream of analysis. In contrast, without Athena capabilities, comp bio folks would have figure out which samples they want by loading a master metadata table somewhere, perform some detective work to track down where the output tables of their desired samples live, and load those files 1-by-1. Additionally, Athena tables are compatible with interactive dashboards, allowing you to keep track of the number of samples, which samples, or other accounting metrics that may be helpful beyond computational teams (business development, project management) in a "no-code" manner.

## Pre-Requisites

The tutorials are in the form of Jupyter Notebooks, and are fully executable. To run the notebooks, the following pre-requisites are required:

1. Python >=3.7
2. AWS credentials
3. Quilt Open Data Account
4. NextFlow Tower Account (optional)

## Questions?

We love to help! Please reach out to the Quilt Data team with any comments or questions. Let's get your data up to snuff together!

- Laura Richards: laura@quiltdata.io
- Simon Kohnstamm: simon@quiltdata.io
- Kevin Moore: kevin@quildata.io